{% extends "base.html" %}

{% block content %}
<div class="dashboard-container">
    <div class="header-section">
        <h1 class="page-title">Recent Papers</h1>
        <form action="{{ url_for('dashboard') }}" method="GET" style="display: flex; gap: 0.5rem;">
            <input type="text" name="q" placeholder="Search concept or keyword..." class="form-input"
                style="width: 300px;" value="{{ request.args.get('q', '') }}">
            <button type="submit" class="btn" style="width: auto;">Search</button>
        </form>
    </div>

    {% if documents %}
    <div class="grid">
        {% for doc in documents %}
        <div class="paper-card" onclick="window.location.href=this.dataset.url;"
            data-url="{{ url_for('document_detail', id=doc.id) }}" style="cursor: pointer;">
            <div class="paper-title">{{ doc.title }}</div>
            <div class="paper-abstract">{{ doc.abstract }}</div>
            <div class="paper-meta">
                <span>{{ doc.published_date.strftime('%Y-%m-%d') if doc.published_date else 'Unknown Date' }}</span>
                <a href="{{ doc.source_url }}" target="_blank" style="color: var(--primary); text-decoration: none;"
                    onclick="event.stopPropagation();">View Source</a>
            </div>
            <form action="{{ url_for('delete_paper', id=doc.id) }}" method="POST" class="delete-btn-wrapper"
                onsubmit="event.stopPropagation();">
                <button type="submit" class="delete-btn"
                    onclick="if(confirm('Are you sure you want to delete this paper?')) { event.stopPropagation(); return true; } else { event.stopPropagation(); return false; }"
                    title="Delete Paper">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    </svg>
                </button>
            </form>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div style="text-align: center; padding: 4rem; color: var(--text-muted);">
        <p>No papers found. Ingestion needed.</p>
    </div>
    {% endif %}
</div>
{% endblock %}